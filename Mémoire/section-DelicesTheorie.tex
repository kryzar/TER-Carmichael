\section{Délices de la théorie}

Certaines propriétés fondamentales des \emph{entiers} de Carmichael restent vraies dans le cadre plus général des \emph{idéaux} de Carmichael. Commençons par généraliser le critère de Korselt.

\begin{theoreme}[critère de Korselt généralisé, 2.2 dans l'article]\label{korselt-generalise}
	Soient $K$ un corps de nombres et $I$ un idéal (premier ou composé) de $\OK$. Les assertions suivantes sont équivalentes :
	\begin{itemize}
		\item pour tout entier algébrique $\alpha \in \OK$, la congruence \[\alpha^{\Norm(I)} \equiv \alpha \pmod{I}\] est vérifiée\footnote{Lorsque cette notion sera définie dans la suite, le lecteur réalisera que cette condition signifie exactement que $I$ n'a aucun $K$-témoin de Fermat.} ~;
		\item l'idéal $I$ est sans facteurs carrés et chacun de ses facteurs premier $\P$ vérifie l'identité \[\Norm(\P) - 1 \mid \Norm(I) - 1.\]
	\end{itemize}
\end{theoreme}

\begin{proof}
	Commençons par le sens réciproque. Soit $\alpha\in \OK$ un entier algébrique et $\p$ un idéal premier de $\OK$ divisant $I$. Si $\alpha \notin \OK$, viennent $\alpha^{\Norm(\p) - 1} \equiv \alpha \pmod{p}$ et donc $$\alpha^{\Norm(I) - 1} \equiv \alpha \pmod{p},$$ car $\Norm(\p) - 1\mid \Norm(I) - 1$ par hypothèse. Si désormais $\alpha\in \p$, la dernière congruence est toujours vérifiée. L'idéal $I$ étant de plus sans facteurs carrés (hypothèse), il est de la forme $I = \p_1 \cdots \p_r,$ les $\p_i$ étant des idéaux premiers distincts de $\OK$. Ces idéaux sont même maximaux (anneau de Dedekind) et donc comaximaux, d'où un isomorphisme d'anneaux $$\OK \big/\left(\p_1\cdot \dots \cdot \p_r\right) \simeq \OK\big/\p_1\times \dots \times \OK\big/ \p_r$$ et la congruence \[\alpha^{\Norm(I)} \equiv \alpha \pmod{I}.\]

	Démontrons cette fois le sens direct. La preuve se fait en deux temps, on montre les relations de divisibilité puis que $I$ est sans facteur carré. Écrivons $I = \p_1^{e_1} \cdot \dots \cdot \p_r^{e_r}$, les $\p_i$ étant des idéaux premiers de $\OK$ distincts. Pour tout indice $1\leqslant i \leqslant r$ donnons nous $\alpha_i\in \OK$ un élément dont la classe modulo $\p_i$ engendre le groupe quotient $(\OK/\p_i)^\times$. Un tel élément existe car $\OK/\p_i$ est un corps fini et que le groupe des inversibles d'un corps fini est cyclique. En particulier, $\alpha_i$ n'est \emph{pas} dans $\p_i$. On a alors \[\alpha_i^{\Norm(I) - 1} \equiv \alpha_i \pmod{\p_i}\] (comme dans le paragraphe précédent) puis que l'ordre de $\alpha_i$ modulo $\p_i$ divise $\Norm(I) - 1$ (théorème de Lagrange). Cet ordre étant $\Norm(\p_i) - 1$, on en déduit la division désirée. 

	Démontrons désormais que $I$ est sans facteurs carrés. Supposons qu'il existe un idéal premier $\p$ de $\OK$ tel que $p^2\mid \OK$ et posons \[H = \left(\OK\big/\p^2\right)^\times.\] On a \[\left|H\right| = \Norm(\p)(\Norm(\p) - 1).\] Soit $p\in \Z$ l'unique nombre premier tel que $p\Z = \p\cap \Z$. L'entier $\Norm(\p)$ est une puissance de $\p$, d'où $p\mid \Norm(\p)$ et \[p\mid \left| H \right|.\] Le théorème de Cauchy abélien assure alors qu'il existe un élément $\alpha \in H$ d'ordre $p$. Comme $I$ est de Carmichael par hypothèse et que $\alpha\notin \p^2$, on a $\alpha^{\Norm(I)-1} \equiv 1 \pmod{\p^2}$ puis $\alpha^{\Norm(I) - 1} \equiv 1 \pmod{\p^2}$ et \[p \mid \Norm(I) - 1.\] Comme $p\mid \Norm(I)$, cela constitue une contradiction. L'idéal $I$ est donc sans facteur carré.
\end{proof}

\begin{remarque}
	Le critère de Korselt que nous connaissons dans le cadre de l'arithmétique se déduit immédiatement du critère de Korselt généralisé en prenant $K=\Q$.
\end{remarque}

On a alors la (fondamentale) caractérisation suivante.

\begin{corollaire}\label{carac-korselt}
	Soient $K$ un corps de nombres et $I$ un idéal de $\OK$. Alors l'idéal $I$ est de Carmichael \ssi il est composé et vérifie les hypothèses du critère de Korselt \ref{korselt-generalise}.
\end{corollaire}

\begin{remarque}
	Il faut ici se montrer vigilant avec la nomenclature. Pour montrer qu'un idéal est de Carmichael, montrer qu'il vérifie le critère de Korselt ne suffit pas. Il faut aussi montrer qu'il est composé. Dans la littérature, on dit en général qu'un idéal vérifie le critère de Korselt s'il vérifie les hypothèses du théorème \ref{korselt-generalise} et en plus qu'il est composé. Nous choisissons ici de distinguer les notions pour éviter toute confusion sur la nature des objets que nous manipulerons.
\end{remarque}

Ce critère permet de généraliser le petit théorème de Fermat.

\begin{theoreme}[petit théorème de Fermat généralisé, 2.3 dans l'article]\label{ptf}
	Soient $p$ un nombre premier et $K/\Q$ une extension galoisienne tels que $p\nmid \Disc(K)$. Alors, pour tout entier algébrique $\alpha \in \OK$, on a $$\alpha^{\Norm_{K/\Q}(p)} \equiv \alpha \pmod{p\OK}.$$
\end{theoreme}

\begin{proof}
	Comme $p\nmid \Disc(K)$, le nombre premier $p$ n'est pas ramifié dans $\OK$. Comme l'extension $K/\Q$ est galoisienne, les indices de ramifications et degrés résiduels des idéaux de $\OK$ au dessus de $\p$ sont égaux. L'idéal $p\OK$ est donc de la forme \[p\OK = \p_1\cdot \dots \p_r.\] Soit donc $f$ ce degré résiduel. On a $ef = [K : \Q]$ et surtout que $f$ divise $[ K : \Q ]$. Ainsi, pour tout indice $1\leq i \leq r$, il vient \[ \Norm(\p_i) - 1 = p^f - 1 \mid p^{[K : \Q]} - 1 = \Norm(p\OK) - 1.\] L'idéal $\OK$ vérifie donc le critère de Korselt généralisé \ref{korselt-generalise}. Il est donc soit premier, soit de Carmichael.
\end{proof}

Nous étendons alors la notion de témoin de Fermat.

\begin{definition}
	Soient $n$ un entier, $K/\Q$ une extension galoisienne et $\alpha\in \OK$ un entier algébrique. On dit que $\alpha$ est un $K$-témoin de Fermat pour $n$ si l'on a \[\alpha^{\Norm(n\OK)} \not \equiv \alpha \pmod{n\OK}.\]
\end{definition}

Un nombre premier n'a donc de témoins de Fermat dans aucun corps de nombres Galoisien et un idéal de Carmichael est un idéal \textbf{composé} n'ayant aucun témoin de Fermat dans l'anneau d'entiers dans lequel il vit. Cette généralisation de la notion de témoin de Fermat apparaît naturellement dans la contraposée du théorème \ref{ptf}.

\begin{theoreme}\label{ptf-contraposee}
	Soient $n$ un entier et $K/\Q$ une extension galoisienne. Si $n$ admet un $K$-témoin de Fermat, alors $n$ est composé.
\end{theoreme}

Fait tout à fait remarquable, l'auteur de l'article donne une réciproque au petit théorème de Fermat généralisé \ref{ptf}.

\begin{theoreme}[réciproque du petit théorème de Fermat généralisé, 2.3 dans l'article]
	Soit $n>2$ un entier composé. Alors il existe un corps \emph{quadratique} $K$ vérifiant $n\nmid \Disc(K)$ dans lequel $n$ admet un $K$-témoin de Fermat.
\end{theoreme}

\begin{MotSurPreuve}
	La preuve de ce résultat est très ingénieuse. Connaissant un diviseur $p$ premier de $n$, l'auteur construit un corps quadratique $K = \Q\left(\sqrt{(-1)^\frac{p-1}{2} p}\right)$ dans lequel $n$ n'est pas de Carmichael. Ce dernier point se démontre avec des techniques de base de la ramification. \\
\end{MotSurPreuve}

\begin{theoreme}[petit théorème de Fermat généralisé et sa réciproque]\label{ptf-reciproque}
	Soit $n>2$ un entier. Alors $n$ est premier \ssi il n'a de $K$-témoin de Fermat dans aucun corps quadratique $K$ vérifiant $n\nmid \Disc(K)$.
\end{theoreme}

\begin{proof}
	C'est la conjonction des théorèmes \ref{ptf} et \ref{ptf-reciproque}.
\end{proof}

\begin{remarque}
Au delà de sa force théorique, cette énoncé semble porter une valeur historique notable. Le test de primalité de Fermat était le seul test de primalité classique à ne pas disposer d'une réciproque (pour le test d'Euler par exemple, c'est une équivalence). Cette absence de réciproque semblait bien être le prix à payer pour sa simplicité et son efficacité. Il aura certes fallu aller chercher la réciproque dans les corps de nombres, mais l'énoncé prouve que les corps quadratiques suffisent. Ces objets ne sont d'ailleurs pas si loin de l'arithmétique classique : Gauss les étudiait déjà.
\end{remarque}

Nous avons déjà des outils suffisamment robustes pour fournir un test de primalité naïf. Comme certains outils de calcul formel sont capables de décomposer un idéal de l'anneau d'entiers d'un corps de nombres en produit d'idéaux premiers dudit anneau\footnote{C'est le cas par exemple de SageMath et PariGP \NTS{mettre liens}. L'auteur de ce texte a choisi d'utiliser Sage et s'en servira beaucoup par la suite.}, il est facile d'implémenter le critère de Korselt \ref{korselt-generalise}. La contraposée du petit théorème de Fermat généralisé \ref{ptf-contraposee} nous permet en suite d'écrire le critère de composition suivant.

\vspace{1em}
\begin{algorithm}[H]\label{test-primalite-korselt}
\caption{Critère de composition de Korselt dans les extensions galoisiennes de $\Q$}
\KwIn{$n$ (entier à tester) \\
	$\mathscr{L}$ (liste d'extensions galoisiennes de $\Q$)}
\ForEach{$K$ dans $\mathscr{L}$}{
	\If{$n$ et $\Disc(K)$ sont premiers entre eux}{
		\If{$n\OK$ ne vérifie pas le critère de Korselt}{
			\KwRet{$n\OK$ n'est pas de Carmichael et $n$ est composé} \\
			\textbf{arrêter le programme.}
		}
	}
}
\end{algorithm}
\vspace{1em}

Avant de poursuivre, donnons un lemme qui permettra d'alléger les énoncés de l'article.

\begin{lemme}
	Soient $n$ un entier et $K$ un corps de nombres. Si $n$ est de Carmichael dans $K$, alors $n$ et $\Disc(K)$ sont premiers entre eux.
\end{lemme}

\begin{proof}
	Si les entiers $n$ et $\Disc(K)$ ne sont pas premiers entre eux, $n$ a un facteur premier qui divise $\Disc(K)$ et qui se ramifie dans $\OK$. L'idéal $n\OK$ a donc un facteur carré, ce qui l'empêche d'être un idéal de Carmichael d'après le critère de Korselt généralisé \ref{korselt-generalise} et la caractérisation \ref{carac-korselt}.
\end{proof}

Ces résultats fournissent un début de théorie confortable. Nous pouvons dès à présent nous confronter à une étude plus spécifique, celle des corps quadratiques.
